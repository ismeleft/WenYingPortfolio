---
title: "ã€Reactã€‘é‡æ–°è¸ä¸ŠReactå­¸ç¿’ä¹‹è·¯ï¼ˆå…«ï¼‰ï¼šå‰¯ä½œç”¨æ˜¯ä»€éº¼"
description: "useEffect é€™å€‹ React Hook åŸºæœ¬ä¸Šæ˜¯å‰›æ¥è§¸ React çš„æ™‚å€™å°±ä¸€å®šæœƒç¢°åˆ°çš„å…¶ä¸­ä¹‹ä¸€çš„è§€å¿µï¼Œæˆ‘åªè¨˜å¾—ç•¶æ™‚çš„æˆ‘åªçŸ¥é“æ‰“ API è¦ç”¨ useEffect ï¼Œè‡³æ–¼å…·é«”è§€å¿µï¼Œå¤§æ¦‚çŸ¥é“æœ‰å‰¯ä½œç”¨ï¼Œåªæ˜¯å‰¯ä½œç”¨æ˜¯ä»€éº¼ï¼Œçœ‹éå°±å¿˜è¨˜äº†ã€‚é€™æ¬¡è—‰ç”±è®€æ›¸æœƒçš„å­¸ç¿’ï¼Œé‡æ–°èªè­˜å‰¯ä½œç”¨ã€‚"
date: "2024-5-18"
tags: ["react"]
---
æœ¬ç¯‡ç­†è¨˜ç‚º Reactæ€ç¶­é€²åŒ–é€™æœ¬æ›¸ 5-1~5-2 çš„è®€æ›¸ç­†è¨˜ã€‚

## å‰è¨€

`useEffect` é€™å€‹ React Hook åŸºæœ¬ä¸Šæ˜¯å‰›æ¥è§¸ React çš„æ™‚å€™å°±ä¸€å®šæœƒç¢°åˆ°çš„å…¶ä¸­ä¹‹ä¸€çš„è§€å¿µï¼Œæˆ‘åªè¨˜å¾—ç•¶æ™‚çš„æˆ‘åªçŸ¥é“æ‰“ API è¦ç”¨ `useEffect` ï¼Œè‡³æ–¼å…·é«”è§€å¿µï¼Œå¤§æ¦‚çŸ¥é“æœ‰å‰¯ä½œç”¨ï¼Œåªæ˜¯å‰¯ä½œç”¨æ˜¯ä»€éº¼ï¼Œçœ‹éå°±å¿˜è¨˜äº†ã€‚é€™æ¬¡è—‰ç”±è®€æ›¸æœƒçš„å­¸ç¿’ï¼Œé‡æ–°èªè­˜å‰¯ä½œç”¨ã€‚

## React ä¸­çš„å‰¯ä½œç”¨è™•ç†ï¼šeffect åˆæ¢

> useEffect ä¸æ˜¯ component function çš„ ç”Ÿå‘½é€±æœŸ API



1. **Effect çš„å®šç¾©èˆ‡å½±éŸ¿**
    - å‰¯ä½œç”¨ï¼ˆside effectsï¼‰æŒ‡çš„æ˜¯å½±éŸ¿å¤–éƒ¨ä¸–ç•Œæˆ–ä¾è³´æ–¼å¤–éƒ¨ç³»çµ±çš„æ“ä½œï¼Œé€™äº›æ“ä½œè¶…å‡ºäº†ç•¶å‰å‡½æ•¸åŸ·è¡Œç’°å¢ƒçš„ç¯„åœã€‚
    - å¸¸è¦‹çš„å‰¯ä½œç”¨åŒ…æ‹¬æ•¸æ“šç²å–ã€è¨‚é–±ã€æ‰‹å‹•æ›´æ”¹ DOM å’Œå®šæ™‚å™¨ã€‚
    
    è€å¯¦èªªæˆ‘é‚„æ»¿ç–‘æƒ‘çš„ï¼Œå–®ç´”é€™éº¼å®šç¾©å‰¯ä½œç”¨ï¼Œä½†æˆ‘å»è¦ºå¾—å¾ˆæ¨¡ç³Šã€‚æ‰€ä»¥æˆ‘é‡å°æˆ‘çš„ç–‘å•è©¢å•çš„ chatGPT
    

    1. å‰¯ä½œç”¨æ˜¯è·Ÿç•¶å‰ç•«é¢ç„¡é—œçš„æ±è¥¿å—ï¼Ÿ 
        1. å‰¯ä½œç”¨ï¼ˆside effectsï¼‰åœ¨ React ä¸­æŒ‡çš„æ˜¯é‚£äº›ä¸å±¬æ–¼ç´”å‡½æ•¸ç¯„ç–‡çš„æ“ä½œï¼Œé€™äº›æ“ä½œå¯èƒ½æœƒå½±éŸ¿å¤–éƒ¨ä¸–ç•Œæˆ–ä¾è³´æ–¼å¤–éƒ¨ç³»çµ±ã€‚
            
            ç°¡å–®ä¾†èªªï¼Œå‰¯ä½œç”¨æ˜¯æŒ‡é‚£äº›åœ¨çµ„ä»¶æ¸²æŸ“éç¨‹ä¸­ï¼Œéœ€è¦èˆ‡å¤–éƒ¨ä¸–ç•Œé€²è¡Œäº’å‹•çš„æ“ä½œã€‚é€™äº›æ“ä½œå¾€å¾€æœƒè¶…å‡º React çš„æ¸²æŸ“ç¯„åœï¼Œå› æ­¤éœ€è¦ç‰¹åˆ¥çš„è™•ç†ã€‚
            
        2. å‰¯ä½œç”¨ä¸¦ä¸å®Œå…¨æ˜¯èˆ‡ç•¶å‰ç•«é¢ç„¡é—œçš„æ±è¥¿ã€‚å¯¦éš›ä¸Šï¼Œè¨±å¤šå‰¯ä½œç”¨æ˜¯ç‚ºäº†æ›´æ–°ç•«é¢è€Œå­˜åœ¨çš„ï¼Œæ¯”å¦‚æ•¸æ“šç²å–å¾Œéœ€è¦æ›´æ–° UIã€‚ä½†é€™äº›æ“ä½œåœ¨ React çš„å‡½æ•¸çµ„ä»¶ä¸­æ˜¯éœ€è¦ç‰¹åˆ¥è™•ç†çš„ï¼Œå› ç‚ºå®ƒå€‘ä¸æ˜¯ç´”å‡½æ•¸çš„è¡Œç‚ºã€‚

        
    2. éåŒæ­¥çš„äº’å‹•éƒ½å¯ä»¥æ˜¯å‰¯ä½œç”¨å—ï¼Ÿ
        1. å¤§éƒ¨åˆ†éåŒæ­¥çš„æ“ä½œéƒ½å¯ä»¥è¦–ç‚ºå‰¯ä½œç”¨ã€‚é€™äº›æ“ä½œé€šå¸¸åŒ…æ‹¬æ•¸æ“šç²å–ã€è¨‚é–±äº‹ä»¶ã€å®šæ™‚æ“ä½œç­‰ã€‚é€™äº›æ“ä½œé€šå¸¸æ˜¯ç•°æ­¥çš„ï¼Œå› ç‚ºå®ƒå€‘éœ€è¦ç­‰å¾…å¤–éƒ¨ç³»çµ±çš„å›æ‡‰æˆ–æ“ä½œå®Œæˆã€‚


    
    
2. **å‰¯ä½œç”¨å¸¶ä¾†çš„æŒ‘æˆ°**
    - å‰¯ä½œç”¨å¯èƒ½é™ä½é æ¸¬æ€§ã€å¢åŠ æ¸¬è©¦é›£åº¦ã€é«˜è€¦åˆåº¦ï¼Œä¸¦ä½¿ç¨‹å¼ç¢¼é›£ä»¥ç¶­è­·å’Œç†è§£ã€‚
    - åœ¨ React component function ä¸­ï¼Œå¤šæ¬¡åŸ·è¡Œçš„å‰¯ä½œç”¨å¯èƒ½å°è‡´ä¸å¯é æ¸¬çš„çµæœï¼Œæ‹–æ…¢ç”šè‡³é˜»å¡å‡½æ•¸çš„è¨ˆç®—æµç¨‹ã€‚


- åœ¨ React ä¸­çš„ hook api
    - `useEffect` ç”¨ä¾†æ¸…é™¤æˆ–é€†è½‰å‰¯ä½œç”¨é€ æˆçš„å½±éŸ¿
    
    ```jsx
    // syntax
    
    useEffect(effectFunction, dependencies);
    ```
    
    - å®šç¾©ä¸€å€‹ effect å‡½å¼ä¾†è™•ç†å‰¯ä½œç”¨
    - cleanup å‡½å¼ä¾†æ¸…ç†å‰¯ä½œç”¨ï¼ˆå¦‚æœæœ‰éœ€è¦çš„è©±ï¼‰
    - æŒ‡å®š effect å‡½å¼çš„ä¾è³´é™£åˆ— â†’ è·³éä¸å¿…è¦çš„å‰¯ä½œç”¨è™•ç†
    - ä¾è³´é™£åˆ—æ±ºå®š Effect å‡½æ•¸çš„åŸ·è¡Œæ™‚æ©Ÿï¼š
        1. æ²’æœ‰ä¾è³´é™£åˆ—ï¼šæ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½æœƒåŸ·è¡Œã€‚
        2. ç©ºé™£åˆ—ï¼šåªæœƒåœ¨é¦–æ¬¡æ¸²æŸ“æ™‚åŸ·è¡Œã€‚
        3. æœ‰ä¾è³´é™£åˆ—ï¼šåªæœ‰ç•¶ä¾è³´é …ç™¼ç”Ÿè®ŠåŒ–æ™‚æ‰æœƒåŸ·è¡Œã€‚
        
    


    ```markdown
    æ­¥é©Ÿï¼š
    
    1. é¦–æ¬¡ render : ä»¥æœ¬æ¬¡ render çš„ props & state ç”¢ç”Ÿå°æ‡‰çš„ç•«é¢çµæ§‹
    å¦‚æœéé¦–æ¬¡ï¼Œé‚„æœƒä»¥å‰ä¸€æ¬¡ render çš„ react element é€²è¡Œæ–°èˆŠæ¯”è¼ƒ
    
    2. ç€è¦½å™¨å®Œæˆå¯¦éš›ç•«é¢çš„ DOM ç¹ªè£½
    
    3. åŸ·è¡Œå‰ä¸€æ¬¡ render çš„ cleanup å‡½å¼ï¼ˆé¦–æ¬¡æ¸²æŸ“æœƒè·³éï¼‰
    // é€™é‚Šæ¸…é™¤çš„æ˜¯å‰ä¸€æ¬¡æ‰€ã€Œç´€éŒ„ã€çš„è³‡æ–™ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“çš„è³‡æ–™éƒ½æ˜¯ç¨ç«‹çš„
    
    4. åŸ·è¡Œæœ¬æ¬¡ render ç‰ˆæœ¬çš„ effect å‡½å¼
    ```
    


    ### ç°¡æ˜“ç¯„ä¾‹
    
    ```jsx
    import React, { useState, useEffect } from 'react';
    
    function Counter() {
        const [count, setCount] = useState(0);
    
        // useEffectä¾†è™•ç†å‰¯ä½œç”¨ï¼šæ›´æ–°ç¶²é æ¨™é¡Œ
        useEffect(() => {
            // è¨­ç½®ç¶²é æ¨™é¡Œç‚ºç•¶å‰è¨ˆæ•¸
            document.title = `You clicked ${count} times`;
    
            // Cleanup function
            return () => {
                // åœ¨çµ„ä»¶é‡æ¸²æŸ“å‰æˆ–å¸è¼‰å‰ï¼ŒåŸ·è¡Œæ¸…ç†æ“ä½œ
                console.log(`Cleaning up previous count: ${count}`);
            };
        }, [count]); // ä¾è³´æ–¼countçš„è®ŠåŒ–
    
        return (
            <div>
                <p>You clicked {count} times</p>
                <button onClick={() => setCount(count + 1)}>Click me</button>
            </div>
        );
    }
    
    export default Counter;
    
    ```
    
    ```jsx
    import React, { useEffect, useState } from 'react';
    
    function FetchDataComponent() {
        const [data, setData] = useState(null);
    
        useEffect(() => {
            fetch('https://api.example.com/data')
                .then(response => response.json())
                .then(data => setData(data))
                .catch(error => console.error('Error fetching data:', error));
        }, []); // ç©ºé™£åˆ—è¡¨ç¤ºé€™å€‹ effect åªæœƒåœ¨çµ„ä»¶é¦–æ¬¡æ¸²æŸ“æ™‚åŸ·è¡Œ
    
        return (
            <div>
                {data ? <p>{JSON.stringify(data)}</p> : <p>Loading data...</p>}
            </div>
        );
    }
    
    ```
    
    ```jsx
    import React, { useEffect, useState } from 'react';
    
    function SubscriptionComponent() {
        const [status, setStatus] = useState('Not connected');
    
        useEffect(() => {
            const eventListener = (event) => {
                setStatus('Connected');
            };
    
            window.addEventListener('connect', eventListener);
    
            // æ¸…ç†å‡½å¼
            return () => {
                window.removeEventListener('connect', eventListener);
            };
        }, []);
    
        return <p>Status: {status}</p>;
    }
    
    ```
    

### useEffect å…¶å¯¦ä¸æ˜¯ function component çš„ç”Ÿå‘½é€±æœŸ API

again and againï¼Œä½œè€…å†åº¦æäº†é€™é» ğŸ˜†

æœ¬ç« è¬›äº†æ»¿å¤šæˆ‘ä»¥å‰çš„èªçŸ¥è§€é»ï¼Œä¾‹å¦‚æˆ‘ä»¥å‰èªç‚ºã€ŒDependencies æ˜¯ç”¨ä¾†æ§åˆ¶åŸ·è¡Œæ™‚æ©Ÿã€ï¼Œä½†ç¾åœ¨æ‰çŸ¥é“åŸä¾†ä¸æ˜¯ã€‚

- `useEffect` æ˜¯ä¸€ç¨®å®£å‘Šå¼çš„åŒæ­¥åŒ–
- `useEffect` çš„å‡ºç¾è§£æ±ºäº†ä»¥å‰ class component å¸¸å®¹æ˜“ç”¢ç”Ÿçš„ bugï¼Œå› ç‚ºç”Ÿå‘½é€±æœŸæœƒéœ€è¦ä»¥æŒ‡ä»¤å¼çš„æ¦‚å¿µå»æ€è€ƒ `didMount`ã€`didUpdate`ã€`willUnmount`ï¼Œå¦‚æœæ¼äº†æŸå€‹éƒ¨åˆ†å°±å¾ˆå®¹æ˜“é€ æˆ bugï¼ŒåŠè¨˜æ†¶é«”æ´©æ¼çš„é¢¨éšª
- æ ¹æ“š render ä¸­çš„ props å’Œ state è³‡æ–™ä¾†åŒæ­¥åŒ–é‚£äº›èˆ‡ç•«é¢ç„¡é—œçš„æ±è¥¿ï¼Œä¹Ÿå°±æ˜¯å‰¯ä½œç”¨çš„è™•ç†ã€‚
- **`useEffect`** çš„ä¾è³´é™£åˆ—ä¸»è¦ç”¨æ–¼æ•ˆèƒ½å„ªåŒ–ï¼Œè€Œéæ§åˆ¶åŸ·è¡Œæ™‚æ©Ÿã€‚å³ä½¿æ²’æœ‰ä¾è³´é™£åˆ—ï¼Œç•«é¢æ¸²æŸ“ä¹Ÿæ‡‰è©²èƒ½æ­£å¸¸åŸ·è¡Œã€‚
- dependencies ç‚ºç©ºé™£åˆ—æ™‚ â†’ åªæœ‰é¦–æ¬¡æ¸²æŸ“æœƒåŸ·è¡Œ
    - å¿…é ˆç¢ºèªçœŸçš„æ²’æœ‰ä»»ä½•ä¾è³´çš„æ™‚å€™æ‰å¡«å¯«ç‚ºç©ºé™£åˆ—ï¼Œä¸æ‡‰è©²å¸Œæœ› effect å‡½å¼åªåŸ·è¡Œä¸€æ¬¡è€Œçµ¦ç©ºé™£åˆ—ã€‚